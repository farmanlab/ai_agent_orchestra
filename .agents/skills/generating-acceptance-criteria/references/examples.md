# Examples

履歴画面（history）の spec.md から生成される受け入れ要件の具体例です。

## 入力: spec.md の該当セクション

### 機能一覧（入力）

```markdown
| 機能 | 説明 |
|------|------|
| 履歴一覧表示 | 月別にグループ化された履歴を表示 |
| タブ切り替え | 「お気に入り」「すべての履歴」の切り替え |
| フィルタリング | カテゴリ別（すべて/数学/英語等）のフィルター |
| ブックマーク | 履歴アイテムのブックマーク状態をトグル |
| 解説画面遷移 | 履歴アイテムタップで解説画面へ遷移 |
```

### インタラクション（入力）

```markdown
| 要素 | data-figma-interaction | data-figma-states | 説明 |
|------|------------------------|-------------------|------|
| 閉じるボタン | `tap:navigate:top` | `default,hover,active` | TOP画面へ遷移 |
| タブ（お気に入り） | `tap:toggle:tab` | `default,active` | お気に入りタブに切り替え |
| タブ（すべての履歴） | `tap:toggle:tab` | `default,active` | すべての履歴タブに切り替え |
| ドロップダウン | `click:show-modal:filter-modal` | `default,hover,active` | フィルターモーダル表示 |
| 履歴アイテム | `tap:navigate:explanation` | `default,hover` | 解説画面へ遷移 |
| ブックマークアイコン | `tap:toggle:bookmark` | `default,bookmarked` | ブックマーク状態をトグル |
```

### 画面フロー（入力）

```markdown
### 流入遷移
| 遷移元 | トリガー | 遷移パラメータ |
|--------|----------|----------------|
| TOP画面 | ボトムナビ「マイリスト」タップ | なし |
| 解説画面 | 戻るボタン | なし |

### 流出遷移
| 遷移先 | トリガー | 条件 |
|--------|----------|------|
| TOP画面 | 閉じるボタンタップ | 常時 |
| 解説画面 | 履歴アイテムタップ | 履歴が存在する場合 |
```

### 表示条件（入力）

```markdown
| 条件 | 動作 |
|------|------|
| 履歴なし | 空状態画面（Node ID: 2350:2795）を表示 |
```

### リストデータ（入力）

```markdown
| リストID | 最小件数 | 最大件数 | 空時の表示 |
|----------|----------|----------|------------|
| histories | 0 | 無制限 | 空状態画面（2350:2795）へ遷移 |
```

---

## 出力: 生成された受け入れ要件

```markdown
## 受け入れ要件

<!-- @generated-by: generating-acceptance-criteria | @timestamp: 2026-01-07 -->

### サマリー

| カテゴリ | 件数 | 必須 | 推奨 | 任意 |
|----------|------|------|------|------|
| 表示 (AC-D) | 5 | 5 | 0 | 0 |
| 操作 (AC-I) | 4 | 8 | 4 | 0 |
| 遷移 (AC-N) | 4 | 4 | 0 | 0 |
| 状態 (AC-S) | 2 | 4 | 2 | 0 |
| API (AC-A) | 2 | 4 | 3 | 0 |
| エッジケース (AC-E) | 2 | 2 | 2 | 0 |
| **合計** | **19** | **27** | **11** | **0** |

---

### 表示要件 (AC-D)

#### AC-D01: 履歴一覧の月別グループ表示

| 項目 | 内容 |
|------|------|
| 対象コンポーネント | `HistoryPage`, `HistorySection` |
| Figma Node | `2350:2725` |

##### シナリオ一覧

| ID | Given (前提条件) | When (操作) | Then (期待結果) | 優先度 |
|----|------------------|-------------|-----------------|--------|
| 01 | 2025年5月と4月の履歴データが存在する | 画面を表示する | 「2025年5月」「2025年4月」のセクションが表示される | 必須 |
| 02 | 2025年5月に3件の履歴がある | 画面を表示する | 5月セクション内に3件のアイテムが表示される | 必須 |
| 03 | 履歴が新しい順にソートされている | 画面を表示する | 最新の月が最上部に表示される | 必須 |

##### モックデータ要件

- `mockHistoriesMultiMonth`: 複数月にまたがる履歴データ
- `mockHistoriesSingleMonth`: 単一月の履歴データ

---

#### AC-D02: 履歴アイテムの表示内容

| 項目 | 内容 |
|------|------|
| 対象コンポーネント | `HistoryItem` |
| Figma Node | `2350:2755` |

##### シナリオ一覧

| ID | Given (前提条件) | When (操作) | Then (期待結果) | 優先度 |
|----|------------------|-------------|-----------------|--------|
| 01 | 履歴データが存在する | 画面を表示する | カテゴリラベルが表示される（例: 「数学 解き方を教えて」） | 必須 |
| 02 | 履歴データが存在する | 画面を表示する | 作成日時がフォーマットされて表示される（例: 「05月15日 14:30」） | 必須 |

---

### 操作要件 (AC-I)

#### AC-I01: ブックマークのトグル

| 項目 | 内容 |
|------|------|
| 対象コンポーネント | `HistoryItem`, `SubmissionBookmark` |
| 関連API | `PUT /student_api/ask_ai/submission/{submission_id}/bookmark` |
| Figma Node | `2350:2780` |

##### シナリオ一覧

| ID | Given (前提条件) | When (操作) | Then (期待結果) | 優先度 |
|----|------------------|-------------|-----------------|--------|
| 01 | 未ブックマークの履歴が存在する | ブックマークアイコンをタップする | アイコンがブックマーク済み状態（塗りつぶし）に変化する | 必須 |
| 02 | ブックマーク済みの履歴が存在する | ブックマークアイコンをタップする | アイコンが未ブックマーク状態（アウトライン）に変化する | 必須 |
| 03 | ブックマーク更新に成功する | アイコンをタップする | トースト通知が表示される | 推奨 |
| 04 | ブックマークAPIがエラーを返す | アイコンをタップする | エラートーストが表示され、状態は元に戻る | 推奨 |

##### モックデータ要件

- `mockHistoryUnbookmarked`: 未ブックマーク状態の履歴
- `mockHistoryBookmarked`: ブックマーク済みの履歴
- `mockBookmarkApiError`: APIエラーレスポンス

---

#### AC-I02: タブ切り替え

| 項目 | 内容 |
|------|------|
| 対象コンポーネント | `TabBar` |
| Figma Node | `2350:2727` |

##### シナリオ一覧

| ID | Given (前提条件) | When (操作) | Then (期待結果) | 優先度 |
|----|------------------|-------------|-----------------|--------|
| 01 | 「すべての履歴」タブが選択状態 | 「お気に入り」タブをタップする | 「お気に入り」タブが選択状態になる | 必須 |
| 02 | 「お気に入り」タブが選択状態 | 「すべての履歴」タブをタップする | 「すべての履歴」タブが選択状態になる | 必須 |
| 03 | 「お気に入り」タブが選択状態 | 画面を表示する | ブックマーク済みの履歴のみ表示される | 必須 |
| 04 | 「すべての履歴」タブが選択状態 | 画面を表示する | 全ての履歴が表示される | 必須 |

---

#### AC-I03: カテゴリフィルター

| 項目 | 内容 |
|------|------|
| 対象コンポーネント | `Dropdown` |
| Figma Node | `2350:2938` |

##### シナリオ一覧

| ID | Given (前提条件) | When (操作) | Then (期待結果) | 優先度 |
|----|------------------|-------------|-----------------|--------|
| 01 | ドロップダウンが閉じている | ドロップダウンをタップする | フィルターメニューが展開される | 必須 |
| 02 | フィルターメニューが展開している | 「数学」を選択する | 数学カテゴリの履歴のみ表示される | 必須 |
| 03 | フィルターメニューが展開している | メニュー外をタップする | メニューが閉じる | 推奨 |

---

#### AC-I04: 閉じるボタン

| 項目 | 内容 |
|------|------|
| 対象コンポーネント | `NavigationHeader` |
| Figma Node | `2350:2726` |

##### シナリオ一覧

| ID | Given (前提条件) | When (操作) | Then (期待結果) | 優先度 |
|----|------------------|-------------|-----------------|--------|
| 01 | 本画面を表示している | 閉じるボタンをタップする | TOP画面に遷移する | 必須 |

---

### 遷移要件 (AC-N)

#### AC-N01: TOP画面からの遷移

| 項目 | 内容 |
|------|------|
| 遷移元 | TOP画面 |
| トリガー | ボトムナビ「マイリスト」タップ |

##### シナリオ一覧

| ID | Given (前提条件) | When (操作) | Then (期待結果) | 優先度 |
|----|------------------|-------------|-----------------|--------|
| 01 | TOP画面を表示している | ボトムナビ「マイリスト」をタップする | 履歴画面に遷移する | 必須 |

---

#### AC-N02: 解説画面への遷移

| 項目 | 内容 |
|------|------|
| 対象コンポーネント | `HistoryItem` |
| 遷移先 | 解説画面 |

##### シナリオ一覧

| ID | Given (前提条件) | When (操作) | Then (期待結果) | 優先度 |
|----|------------------|-------------|-----------------|--------|
| 01 | 履歴アイテムが表示されている | アイテムをタップする | 解説画面に遷移する | 必須 |
| 02 | 履歴アイテムが表示されている | アイテムをタップする | 履歴IDがパラメータとして渡される | 必須 |

##### 遷移パラメータ

| パラメータ | 型 | 説明 |
|-----------|-----|------|
| `historyId` | string | 履歴アイテムのID |

---

#### AC-N03: TOP画面への遷移（閉じる）

| 項目 | 内容 |
|------|------|
| 遷移先 | TOP画面 |
| トリガー | 閉じるボタン / トップナビ |

##### シナリオ一覧

| ID | Given (前提条件) | When (操作) | Then (期待結果) | 優先度 |
|----|------------------|-------------|-----------------|--------|
| 01 | 本画面を表示している | 閉じるボタンをタップする | TOP画面に遷移する | 必須 |

---

### 状態要件 (AC-S)

#### AC-S01: タブ選択状態

| 項目 | 内容 |
|------|------|
| 対象コンポーネント | `TabBar` |
| 状態 | `default`, `active` |

##### シナリオ一覧

| ID | Given (前提条件) | When (操作) | Then (期待結果) | 優先度 |
|----|------------------|-------------|-----------------|--------|
| 01 | 「すべての履歴」タブが選択状態 | 画面を表示する | タブが青背景・白文字で表示される | 必須 |
| 02 | 「お気に入り」タブが非選択状態 | 画面を表示する | タブが白背景・グレーボーダーで表示される | 必須 |
| 03 | タブを切り替える | 切り替え操作を行う | 選択状態のスタイルが即座に変化する | 推奨 |

---

#### AC-S02: ブックマーク状態

| 項目 | 内容 |
|------|------|
| 対象コンポーネント | `SubmissionBookmark` |
| 状態 | `default`, `bookmarked` |

##### シナリオ一覧

| ID | Given (前提条件) | When (操作) | Then (期待結果) | 優先度 |
|----|------------------|-------------|-----------------|--------|
| 01 | 未ブックマーク状態 | 画面を表示する | アウトラインアイコンが表示される | 必須 |
| 02 | ブックマーク済み状態 | 画面を表示する | 塗りつぶしアイコン（#33AAB2）が表示される | 必須 |
| 03 | 状態をトグルする | アイコンをタップする | アニメーション付きで状態が変化する | 推奨 |

---

### API要件 (AC-A)

#### AC-A01: 履歴データの取得

| 項目 | 内容 |
|------|------|
| 対象コンポーネント | `HistoryPage` |
| エンドポイント | `GET /student_api/ask_ai/submission/history` |
| タイミング | 画面表示時、フィルター変更時 |

##### シナリオ一覧

| ID | Given (前提条件) | When (操作) | Then (期待結果) | 優先度 |
|----|------------------|-------------|-----------------|--------|
| 01 | ユーザーが認証済み | 画面を表示する | 履歴取得APIが呼び出される | 必須 |
| 02 | APIが履歴データを返す | 画面を表示する | データが月別グループで表示される | 必須 |
| 03 | 「数学」フィルターを選択する | フィルターを変更する | `submission_type=mathExplanation` でAPIが呼び出される | 必須 |
| 04 | 「お気に入り」タブを選択する | タブを切り替える | `is_bookmarked=true` でAPIが呼び出される | 必須 |
| 05 | APIが500エラーを返す | 画面を表示する | エラー画面が表示される | 推奨 |
| 06 | ネットワークエラーが発生する | 画面を表示する | エラーメッセージとリトライボタンが表示される | 推奨 |

##### クエリパラメータ

| パラメータ | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| `submission_type` | string | No | フィルタータイプ（all, mathExplanation, etc.） |
| `is_bookmarked` | boolean | No | お気に入りフィルター |

---

#### AC-A02: ブックマーク更新

| 項目 | 内容 |
|------|------|
| 対象コンポーネント | `SubmissionBookmark` |
| エンドポイント | `PUT /student_api/ask_ai/submission/{submission_id}/bookmark` |
| タイミング | ブックマークアイコンタップ時 |

##### シナリオ一覧

| ID | Given (前提条件) | When (操作) | Then (期待結果) | 優先度 |
|----|------------------|-------------|-----------------|--------|
| 01 | 未ブックマーク状態 | アイコンをタップする | `is_bookmarked: true` でAPIが呼び出される | 必須 |
| 02 | ブックマーク済み状態 | アイコンをタップする | `is_bookmarked: false` でAPIが呼び出される | 必須 |
| 03 | APIが成功を返す | 更新完了 | キャッシュが無効化され一覧が再取得される | 推奨 |

---

### エッジケース要件 (AC-E)

#### AC-E01: 履歴データが空の場合

| 項目 | 内容 |
|------|------|
| 対象コンポーネント | `HistoryPage`, `EmptyHistory` |
| Figma Node | `2350:2795` |

##### シナリオ一覧

| ID | Given (前提条件) | When (操作) | Then (期待結果) | 優先度 |
|----|------------------|-------------|-----------------|--------|
| 01 | 履歴データが0件 | 画面を表示する | 空状態画面が表示される | 必須 |
| 02 | 空状態画面が表示されている | 画面を確認する | イラストとメッセージが表示される | 必須 |

---

#### AC-E02: フィルター結果が空の場合

| 項目 | 内容 |
|------|------|
| 対象コンポーネント | `HistoryPage` |

##### シナリオ一覧

| ID | Given (前提条件) | When (操作) | Then (期待結果) | 優先度 |
|----|------------------|-------------|-----------------|--------|
| 01 | 「お気に入り」タブでブックマーク0件 | タブを切り替える | 「お気に入りがありません」メッセージが表示される | 推奨 |
| 02 | 「数学」フィルターで該当0件 | フィルターを変更する | 「該当する履歴がありません」メッセージが表示される | 推奨 |

---

### 非機能要件

| ID | 要件 | 基準値 | 測定方法 |
|----|------|--------|----------|
| NFR-01 | 初回表示時間 | 3秒以内 | Lighthouse |
| NFR-02 | ブックマーク状態変更のフィードバック | 即時（100ms以内） | Performance API |
| NFR-03 | 画像サムネイルの読み込み | 遅延読み込み対応 | DevTools Network |
| NFR-04 | スクロール時のパフォーマンス | 60fps維持 | DevTools Performance |
```

---

## テストコードへの変換例

上記の受け入れ要件から生成されるテストコードのイメージ：

```typescript
// tests/history/AC-I01-bookmark.test.tsx
import { render, screen } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import { server } from '@/mocks/server';
import { mockHistoryUnbookmarked, mockHistoryBookmarked } from '@/mocks/history';
import { mockBookmarkApiError } from '@/mocks/bookmark';
import { HistoryItem } from '@/components/HistoryItem';

describe('AC-I01: ブックマークのトグル', () => {
  describe('正常系', () => {
    it('01: 未ブックマーク → ブックマーク済みに変化する', async () => {
      // Given: 未ブックマークの履歴が存在する
      render(<HistoryItem history={mockHistoryUnbookmarked} />);

      // When: ブックマークアイコンをタップする
      const bookmarkButton = screen.getByRole('button', { name: 'ブックマーク' });
      await userEvent.click(bookmarkButton);

      // Then: アイコンがブックマーク済み状態に変化する
      expect(bookmarkButton).toHaveAttribute('aria-pressed', 'true');
      expect(bookmarkButton).toHaveClass('bookmarked');
    });

    it('02: ブックマーク済み → 未ブックマークに変化する', async () => {
      // Given: ブックマーク済みの履歴が存在する
      render(<HistoryItem history={mockHistoryBookmarked} />);

      // When: ブックマークアイコンをタップする
      const bookmarkButton = screen.getByRole('button', { name: 'ブックマーク' });
      await userEvent.click(bookmarkButton);

      // Then: アイコンが未ブックマーク状態に変化する
      expect(bookmarkButton).toHaveAttribute('aria-pressed', 'false');
      expect(bookmarkButton).not.toHaveClass('bookmarked');
    });
  });

  describe('エラー系', () => {
    it('04: APIエラー時はエラートーストが表示される', async () => {
      // Given: ブックマークAPIがエラーを返す
      server.use(mockBookmarkApiError);
      render(<HistoryItem history={mockHistoryUnbookmarked} />);

      // When: ブックマークアイコンをタップする
      await userEvent.click(screen.getByRole('button', { name: 'ブックマーク' }));

      // Then: エラートーストが表示される
      expect(await screen.findByRole('alert')).toHaveTextContent('エラーが発生しました');
      // Then: 状態は元に戻る
      expect(screen.getByRole('button', { name: 'ブックマーク' }))
        .toHaveAttribute('aria-pressed', 'false');
    });
  });
});
```
