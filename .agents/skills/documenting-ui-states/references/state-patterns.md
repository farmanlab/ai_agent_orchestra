# 状態パターンと検出ルール

UI状態の一般的なパターンと、Figmaフレーム名からの検出ルールを定義します。

## 目次

1. [画面レベルの状態](#画面レベルの状態)
2. [データ依存の状態](#データ依存の状態)
3. [ユーザー操作の状態](#ユーザー操作の状態)
4. [検出ルール](#検出ルール)
5. [状態の優先度](#状態の優先度)

---

## 画面レベルの状態

画面全体に影響する状態パターン。

### default（デフォルト）

| 項目 | 内容 |
|------|------|
| 説明 | 正常にデータが表示されている状態 |
| 条件 | API成功 & データあり |
| 検出パターン | `_Default`, `_Normal`, サフィックスなし |
| 必須度 | 🔴 必須 |

### loading（読み込み中）

| 項目 | 内容 |
|------|------|
| 説明 | データ取得中の状態 |
| 条件 | API通信中 |
| 検出パターン | `_Loading`, `_Skeleton`, `_Fetching` |
| 必須度 | 🔴 必須（非同期データがある場合） |
| 表示パターン | スケルトン / スピナー / プログレスバー |

### empty（空状態）

| 項目 | 内容 |
|------|------|
| 説明 | データが0件の状態 |
| 条件 | API成功 & データ0件 |
| 検出パターン | `_Empty`, `_NoData`, `_NoResults`, `_Zero` |
| 必須度 | 🔴 必須（リスト画面） |
| 表示パターン | イラスト + メッセージ + アクションボタン |

### error（エラー）

| 項目 | 内容 |
|------|------|
| 説明 | エラーが発生した状態 |
| 条件 | API失敗 / バリデーションエラー |
| 検出パターン | `_Error`, `_Failed`, `_Failure` |
| 必須度 | 🔴 必須 |
| 表示パターン | エラーメッセージ + リトライボタン |

### success（成功）

| 項目 | 内容 |
|------|------|
| 説明 | 操作が成功した状態 |
| 条件 | 送信/保存/削除等の完了 |
| 検出パターン | `_Success`, `_Complete`, `_Done`, `_Confirmed` |
| 必須度 | 🟡 操作系画面で必要 |
| 表示パターン | 成功メッセージ / 完了画面 / トースト |

---

## データ依存の状態

表示データの内容によって変化する状態。

### partial（一部表示）

| 項目 | 内容 |
|------|------|
| 説明 | 一部のデータのみ表示されている状態 |
| 条件 | ページネーション / 無限スクロール |
| 検出パターン | `_Partial`, `_LoadMore` |
| 必須度 | 🟡 ページネーションがある場合 |

### filtered（フィルター適用）

| 項目 | 内容 |
|------|------|
| 説明 | フィルターが適用された状態 |
| 条件 | フィルター選択中 |
| 検出パターン | `_Filtered`, `_Searched` |
| 必須度 | 🟢 フィルター機能がある場合 |

### stale（古いデータ）

| 項目 | 内容 |
|------|------|
| 説明 | キャッシュデータを表示中 |
| 条件 | オフライン / バックグラウンド更新中 |
| 検出パターン | `_Stale`, `_Cached`, `_Offline` |
| 必須度 | 🟢 オフライン対応する場合 |

---

## ユーザー操作の状態

ユーザーの操作によって変化する状態。

### selected（選択中）

| 項目 | 内容 |
|------|------|
| 説明 | アイテムが選択されている状態 |
| 条件 | ユーザーがアイテムを選択 |
| 検出パターン | `_Selected`, `_Active`, `_Checked` |
| 必須度 | 🟡 選択機能がある場合 |

### editing（編集中）

| 項目 | 内容 |
|------|------|
| 説明 | 編集モードの状態 |
| 条件 | 編集ボタン押下 |
| 検出パターン | `_Editing`, `_Edit`, `_EditMode` |
| 必須度 | 🟡 編集機能がある場合 |

### expanded / collapsed（展開/折りたたみ）

| 項目 | 内容 |
|------|------|
| 説明 | 詳細表示の展開状態 |
| 条件 | アコーディオン操作 |
| 検出パターン | `_Expanded`, `_Open` / `_Collapsed`, `_Closed` |
| 必須度 | 🟢 アコーディオンがある場合 |

---

## 検出ルール

### フレーム名パターン

```
{ScreenName}_{StateSuffix}

例:
- CourseList_Default
- CourseList_Empty
- CourseList_Loading
- CourseList_Error
```

### 検出優先順位

同一画面に複数のフレームがある場合の判定順序：

1. **完全一致**: `Screen_Empty` → `empty`
2. **部分一致**: `Screen_NoData_v2` → `empty`
3. **サフィックスなし**: `Screen` → `default`

### バリアント検出

Figma Variantsを使用している場合：

```
Component
├── State=Default
├── State=Empty
├── State=Loading
└── State=Error
```

プロパティ名 `State`, `状態`, `status` を検出対象とする。

### 検出できない場合

以下の場合は手動確認が必要：

- 命名規則が不統一
- 日本語のみのフレーム名（`画面_空状態`等）
- バリアント名が不明確

---

## 状態の優先度

実装時に考慮すべき優先度。

### 🔴 必須（Must Have）

全ての画面で必要な状態：

| 状態 | 条件 |
|------|------|
| default | 常に必須 |
| loading | 非同期データがある場合 |
| error | API通信がある場合 |
| empty | リスト/検索結果がある場合 |

### 🟡 推奨（Should Have）

機能によって必要な状態：

| 状態 | 条件 |
|------|------|
| success | フォーム送信/操作完了がある場合 |
| selected | 選択機能がある場合 |
| editing | 編集機能がある場合 |
| disabled | 非活性条件がある場合 |

### 🟢 任意（Nice to Have）

UX向上のための状態：

| 状態 | 条件 |
|------|------|
| stale | オフライン対応 |
| partial | 無限スクロール |
| filtered | 高度なフィルター |

---

## 状態組み合わせマトリクス

画面タイプ別の必要状態：

| 画面タイプ | default | loading | empty | error | success |
|-----------|:-------:|:-------:|:-----:|:-----:|:-------:|
| 一覧画面 | ✓ | ✓ | ✓ | ✓ | - |
| 詳細画面 | ✓ | ✓ | - | ✓ | - |
| フォーム画面 | ✓ | ✓ | - | ✓ | ✓ |
| 設定画面 | ✓ | ✓ | - | ✓ | ✓ |
| ダッシュボード | ✓ | ✓ | ✓ | ✓ | - |
| モーダル | ✓ | ✓ | - | ✓ | ✓ |
