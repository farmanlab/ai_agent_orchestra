# Section Template

spec.md の「受け入れ要件」セクションの出力テンプレートです。

## セクション全体構造

```markdown
## 受け入れ要件

<!-- @generated-by: generating-acceptance-criteria | @timestamp: {YYYY-MM-DD} -->

### サマリー

| カテゴリ | 件数 | 必須 | 推奨 | 任意 |
|----------|------|------|------|------|
| 表示 (AC-D) | {n} | {n} | {n} | {n} |
| 操作 (AC-I) | {n} | {n} | {n} | {n} |
| 遷移 (AC-N) | {n} | {n} | {n} | {n} |
| 状態 (AC-S) | {n} | {n} | {n} | {n} |
| API (AC-A) | {n} | {n} | {n} | {n} |
| エッジケース (AC-E) | {n} | {n} | {n} | {n} |
| **合計** | **{total}** | **{n}** | **{n}** | **{n}** |

---

### 表示要件 (AC-D)

{AC-D要件一覧}

---

### 操作要件 (AC-I)

{AC-I要件一覧}

---

### 遷移要件 (AC-N)

{AC-N要件一覧}

---

### 状態要件 (AC-S)

{AC-S要件一覧}

---

### API要件 (AC-A)

{AC-A要件一覧}

---

### エッジケース要件 (AC-E)

{AC-E要件一覧}

---

### 非機能要件

| ID | 要件 | 基準値 | 測定方法 |
|----|------|--------|----------|
| NFR-01 | 初回表示時間 | 3秒以内 | Lighthouse |
| NFR-02 | インタラクション応答時間 | 100ms以内 | Performance API |
| NFR-03 | 画像遅延読み込み | Lazy Load対応 | DevTools |
```

## 個別要件テンプレート

### 基本形式

```markdown
#### AC-{カテゴリ}{番号}: {要件名}

| 項目 | 内容 |
|------|------|
| 対象コンポーネント | `{ComponentName}` |
| 関連API | `{METHOD} {endpoint}` |
| Figma Node | `{nodeId}` |

##### シナリオ一覧

| ID | Given (前提条件) | When (操作) | Then (期待結果) | 優先度 |
|----|------------------|-------------|-----------------|--------|
| 01 | {前提条件1} | {操作1} | {期待結果1} | 必須 |
| 02 | {前提条件2} | {操作2} | {期待結果2} | 推奨 |

##### モックデータ要件

- `mock{Name}`: {説明}
- `mock{Name}Error`: {説明}
```

### 表示要件 (AC-D) テンプレート

```markdown
#### AC-D01: 履歴一覧の月別グループ表示

| 項目 | 内容 |
|------|------|
| 対象コンポーネント | `HistoryPage`, `HistorySection` |
| Figma Node | `2350:2725` |

##### シナリオ一覧

| ID | Given (前提条件) | When (操作) | Then (期待結果) | 優先度 |
|----|------------------|-------------|-----------------|--------|
| 01 | 2025年5月と4月の履歴データが存在する | 画面を表示する | 「2025年5月」「2025年4月」のセクションが表示される | 必須 |
| 02 | 2025年5月に3件の履歴がある | 画面を表示する | 5月セクション内に3件のアイテムが表示される | 必須 |
| 03 | 履歴が新しい順にソートされている | 画面を表示する | 最新の月が最上部に表示される | 必須 |

##### モックデータ要件

- `mockHistories`: 複数月にまたがる履歴データ
- `mockHistoriesSingleMonth`: 単一月の履歴データ
```

### 操作要件 (AC-I) テンプレート

```markdown
#### AC-I01: ブックマークのトグル

| 項目 | 内容 |
|------|------|
| 対象コンポーネント | `HistoryItem`, `SubmissionBookmark` |
| 関連API | `PUT /student_api/ask_ai/submission/{id}/bookmark` |
| Figma Node | `2350:2780` |

##### シナリオ一覧

| ID | Given (前提条件) | When (操作) | Then (期待結果) | 優先度 |
|----|------------------|-------------|-----------------|--------|
| 01 | 未ブックマークの履歴が存在する | ブックマークアイコンをタップする | アイコンがブックマーク済み状態に変化する | 必須 |
| 02 | ブックマーク済みの履歴が存在する | ブックマークアイコンをタップする | アイコンが未ブックマーク状態に変化する | 必須 |
| 03 | ブックマーク更新に成功する | アイコンをタップする | 「お気に入りに追加しました」トーストが表示される | 推奨 |
| 04 | ブックマークAPIがエラーを返す | アイコンをタップする | エラートーストが表示される | 推奨 |
| 05 | API通信中 | アイコンをタップする | ローディング状態が表示される（連打防止） | 推奨 |

##### モックデータ要件

- `mockHistoryUnbookmarked`: 未ブックマーク状態の履歴
- `mockHistoryBookmarked`: ブックマーク済みの履歴
- `mockBookmarkApiSuccess`: 正常レスポンス
- `mockBookmarkApiError`: エラーレスポンス
```

### 遷移要件 (AC-N) テンプレート

```markdown
#### AC-N01: 解説画面への遷移

| 項目 | 内容 |
|------|------|
| 対象コンポーネント | `HistoryItem` |
| 遷移先 | 解説画面 (`/ask_ai/explanation/{id}`) |
| Figma Node | `2350:2755` |

##### シナリオ一覧

| ID | Given (前提条件) | When (操作) | Then (期待結果) | 優先度 |
|----|------------------|-------------|-----------------|--------|
| 01 | 履歴アイテムが表示されている | アイテムをタップする | 解説画面に遷移する | 必須 |
| 02 | 履歴アイテムが表示されている | アイテムをタップする | 履歴IDがパラメータとして渡される | 必須 |

##### 遷移パラメータ

| パラメータ | 型 | 説明 |
|-----------|-----|------|
| `historyId` | string | 履歴アイテムのID |
```

### 状態要件 (AC-S) テンプレート

```markdown
#### AC-S01: タブ選択状態

| 項目 | 内容 |
|------|------|
| 対象コンポーネント | `TabBar` |
| 状態 | `default`, `active` |
| Figma Node | `2350:2727` |

##### シナリオ一覧

| ID | Given (前提条件) | When (操作) | Then (期待結果) | 優先度 |
|----|------------------|-------------|-----------------|--------|
| 01 | 「すべての履歴」タブが選択状態 | 画面を表示する | タブが青背景・白文字で表示される | 必須 |
| 02 | 「お気に入り」タブが非選択状態 | 画面を表示する | タブが白背景・グレーボーダーで表示される | 必須 |
| 03 | 「すべての履歴」選択状態 | 「お気に入り」をタップする | 「お気に入り」が選択状態に変化する | 必須 |

##### 状態定義

| 状態 | CSS クラス | 視覚変化 |
|------|----------|----------|
| default | `.tab--inactive` | 白背景、グレーボーダー |
| active | `.tab--active` | 青背景 (#0070E0)、白文字 |
```

### API要件 (AC-A) テンプレート

```markdown
#### AC-A01: 履歴データの取得

| 項目 | 内容 |
|------|------|
| 対象コンポーネント | `HistoryPage` |
| エンドポイント | `GET /student_api/ask_ai/submission/history` |
| タイミング | 画面表示時、フィルター変更時 |

##### シナリオ一覧

| ID | Given (前提条件) | When (操作) | Then (期待結果) | 優先度 |
|----|------------------|-------------|-----------------|--------|
| 01 | ユーザーが認証済み | 画面を表示する | 履歴取得APIが呼び出される | 必須 |
| 02 | APIが履歴データを返す | 画面を表示する | データがUIにバインドされる | 必須 |
| 03 | 「数学」フィルターを選択する | フィルターを変更する | `submission_type=mathExplanation` でAPIが呼び出される | 必須 |
| 04 | APIが500エラーを返す | 画面を表示する | エラー画面が表示される | 推奨 |
| 05 | ネットワークエラーが発生する | 画面を表示する | エラーメッセージとリトライボタンが表示される | 推奨 |

##### クエリパラメータ

| パラメータ | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| `submission_type` | string | No | フィルタータイプ |
| `is_bookmarked` | boolean | No | お気に入りフィルター |

##### モックデータ要件

- `mockHistoryResponse`: 正常レスポンス
- `mockHistoryEmptyResponse`: 空レスポンス
- `mockHistoryErrorResponse`: エラーレスポンス
```

### エッジケース要件 (AC-E) テンプレート

```markdown
#### AC-E01: 履歴データが空の場合

| 項目 | 内容 |
|------|------|
| 対象コンポーネント | `HistoryPage`, `EmptyHistory` |
| Figma Node | `2350:2795` |

##### シナリオ一覧

| ID | Given (前提条件) | When (操作) | Then (期待結果) | 優先度 |
|----|------------------|-------------|-----------------|--------|
| 01 | 履歴データが0件 | 画面を表示する | 空状態画面が表示される | 必須 |
| 02 | 空状態画面が表示されている | 画面を確認する | イラストとメッセージが表示される | 必須 |
| 03 | 「お気に入り」タブでブックマーク0件 | タブを切り替える | 「お気に入りがありません」メッセージが表示される | 推奨 |

##### 空状態のバリエーション

| 条件 | 表示メッセージ |
|------|---------------|
| 履歴0件 | 「履歴がありません」 |
| お気に入り0件 | 「お気に入りがありません」 |
| フィルター結果0件 | 「該当する履歴がありません」 |
```

## テストコード対応表

生成した受け入れ要件がテストコードにどう対応するかの参考：

```typescript
// AC-I01: ブックマークのトグル
describe('AC-I01: ブックマークのトグル', () => {
  // AC-I01-01
  it('01: 未ブックマーク → ブックマーク済みに変化する', async () => {
    // Given: 未ブックマークの履歴が存在する
    const history = mockHistoryUnbookmarked;
    render(<HistoryItem history={history} />);

    // When: ブックマークアイコンをタップする
    await userEvent.click(screen.getByRole('button', { name: 'ブックマーク' }));

    // Then: アイコンがブックマーク済み状態に変化する
    expect(screen.getByRole('button', { name: 'ブックマーク' }))
      .toHaveAttribute('aria-pressed', 'true');
  });

  // AC-I01-02
  it('02: ブックマーク済み → 未ブックマークに変化する', async () => {
    // ...
  });

  // AC-I01-04
  it('04: APIエラー時はエラートーストが表示される', async () => {
    // Given: ブックマークAPIがエラーを返す
    server.use(mockBookmarkApiError);
    // ...
  });
});
```
